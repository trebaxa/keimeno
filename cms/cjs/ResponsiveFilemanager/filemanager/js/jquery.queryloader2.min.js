/*
 * QueryLoader v2 - A simple script to create a preloader for images
 *
 * For instructions read the original post:
 * http://www.gayadesign.com/diy/queryloader2-preload-your-images-with-ease/
 *
 * Copyright (c) 2011 - Gaya Kessler
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Version:  2.8.3
 * Last update: 2013-12-05
 */(function(e){function t(e){this.parent=e;this.container;this.loadbar;this.percentageContainer}function n(e){this.toPreload=[];this.parent=e;this.container}function r(e){this.element;this.parent=e}function i(r,i){this.element=r;this.$element=e(r);this.options=i;this.foundUrls=[];this.destroyed=!1;this.imageCounter=0;this.imageDone=0;this.alreadyLoaded=!1;this.preloadContainer=new n(this);this.overlayLoader=new t(this);this.defaultOptions={onComplete:function(){},onLoadComplete:function(){},backgroundColor:"#000",barColor:"#fff",overlayId:"qLoverlay",barHeight:1,percentage:!1,deepSearch:!0,completeAnimation:"fade",minimumTime:500};this.init()}t.prototype.createOverlay=function(){var t="absolute";if(this.parent.element.tagName.toLowerCase()=="body")t="fixed";else{var n=this.parent.$element.css("position");(n!="fixed"||n!="absolute")&&this.parent.$element.css("position","relative")}this.container=e("<div id='"+this.parent.options.overlayId+"'></div>").css({width:"100%",height:"100%",backgroundColor:this.parent.options.backgroundColor,backgroundPosition:"fixed",position:t,zIndex:666999,top:0,left:0}).appendTo(this.parent.$element);this.loadbar=e("<div id='qLbar'></div>").css({height:"35px",marginTop:"0px",width:"0%",position:"absolute"}).appendTo(this.container);this.parent.options.percentage==1&&(this.percentageContainer=e("<div id='qLpercentage'></div>").text("0%").css({position:"absolute",bottom:"10px",right:"10px",textAlign:"center"}).appendTo(this.container));(!this.parent.preloadContainer.toPreload.length||this.parent.alreadyLoaded==1)&&this.parent.destroyContainers()};t.prototype.updatePercentage=function(e){this.loadbar.stop().animate({width:e+"%",minWidth:e+"%"},200);this.parent.options.percentage==1&&this.percentageContainer.text(Math.ceil(e)+"%")};n.prototype.create=function(){this.container=e("<div></div>").appendTo("body").css({display:"none",width:0,height:0,overflow:"hidden"});this.processQueue()};n.prototype.processQueue=function(){for(var e=0;this.toPreload.length>e;e++)this.parent.destroyed||this.preloadImage(this.toPreload[e])};n.prototype.addImage=function(e){this.toPreload.push(e)};n.prototype.preloadImage=function(e){var t=new r;t.addToPreloader(this,e);t.bindLoadEvent()};r.prototype.addToPreloader=function(t,n){this.element=e("<img />").attr("src",n);this.element.appendTo(t.container);this.parent=t.parent};r.prototype.bindLoadEvent=function(){this.parent.imageCounter++;var e=this.element.attr("src");this.element.removeAttr("src");var t=this;setTimeout(function(){t.element.on("load error",t,function(e){e.data.completeLoading()});t.element.attr("src",e)},1)};r.prototype.completeLoading=function(){this.parent.imageDone++;var e=this.parent.imageDone/this.parent.imageCounter*100;this.parent.overlayLoader.updatePercentage(e);this.parent.imageDone==this.parent.imageCounter&&this.parent.endLoader()};i.prototype.init=function(){this.options=e.extend({},this.defaultOptions,this.options);var t=this.findImageInElement(this.element);if(this.options.deepSearch==1){var n=this.$element.find("*:not(script)");for(var r=0;r<n.length;r++)this.findImageInElement(n[r])}this.preloadContainer.create();this.overlayLoader.createOverlay()};i.prototype.findImageInElement=function(t){var n="",i=e(t),s="normal";if(i.css("background-image")!="none"){n=i.css("background-image");s="background"}else typeof i.attr("src")!="undefined"&&t.nodeName.toLowerCase()=="img"&&(n=i.attr("src"));if(!this.hasGradient(n)){n=this.stripUrl(n);var o=n.split(", ");for(var u=0;u<o.length;u++)if(this.validUrl(o[u])&&this.urlIsNew(o[u])){var a="";if(this.isIE()||this.isOpera()){a="?rand="+Math.random();this.preloadContainer.addImage(o[u]+a)}else if(s=="background")this.preloadContainer.addImage(o[u]+a);else{var f=new r(this);f.element=i;f.bindLoadEvent()}this.foundUrls.push(o[u])}}};i.prototype.hasGradient=function(e){return e.indexOf("gradient")==-1?!1:!0};i.prototype.stripUrl=function(e){e=e.replace(/url\(\"/g,"");e=e.replace(/url\(/g,"");e=e.replace(/\"\)/g,"");e=e.replace(/\)/g,"");return e};i.prototype.isIE=function(){return navigator.userAgent.match(/msie/i)};i.prototype.isOpera=function(){return navigator.userAgent.match(/Opera/i)};i.prototype.validUrl=function(e){return e.length>0&&!e.match(/^(data:)/i)?!0:!1};i.prototype.urlIsNew=function(e){return this.foundUrls.indexOf(e)==-1?!0:!1};i.prototype.destroyContainers=function(){this.destroyed=!0;this.preloadContainer.container.remove();this.overlayLoader.container.remove()};i.prototype.endLoader=function(){this.destroyed=!0;this.onLoadComplete()};i.prototype.onLoadComplete=function(){this.options.onLoadComplete();if(this.options.completeAnimation=="grow"){var t=this.options.minimumTime;this.overlayLoader.loadbar[0].parent=this;this.overlayLoader.loadbar.stop().animate({width:"100%"},t,function(){e(this).animate({top:"0%",width:"100%",height:"100%"},500,function(){this.parent.overlayLoader.container[0].parent=this.parent;this.parent.overlayLoader.container.fadeOut(500,function(){this.parent.destroyContainers();this.parent.options.onComplete()})})})}else{this.overlayLoader.container[0].parent=this;this.overlayLoader.container.fadeOut(500,function(){this.parent.destroyContainers();this.parent.options.onComplete()})}};Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;n=n<0?Math.ceil(n):Math.floor(n);n<0&&(n+=t);for(;n<t;n++)if(n in this&&this[n]===e)return n;return-1});e.fn.queryLoader2=function(e){return this.each(function(){new i(this,e)})}})(jQuery);